<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAKER Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .content { padding: 30px; }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .metric-card {
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        .metric-card:hover { transform: translateY(-5px); }
        .metric-card.success { background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); }
        .metric-card.info { background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%); }
        .metric-card.warning { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); }
        .metric-card.danger { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); }
        .metric-label {
            font-size: 0.9em;
            color: #555;
            margin-bottom: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #333;
        }
        .metric-subtitle {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
        }
        .section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
        }
        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        .cost-breakdown {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .cost-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .cost-item h3 { color: #667eea; margin-bottom: 15px; }
        .cost-detail {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        .cost-detail:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 1.1em;
            color: #667eea;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 2px solid #e0e0e0;
        }
        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
        }
        tr:hover { background: #f5f7fa; }
        .highlight-row { background: #e3f2fd !important; }
        .alert {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid;
        }
        .alert.warning {
            background: #fff3e0;
            border-color: #ff9800;
            color: #e65100;
        }
        .video-container {
            text-align: center;
            margin: 30px 0;
        }
        .video-container video {
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üóº MAKER Framework Dashboard</h1>
            <p>Tower of Hanoi Solver - Live Run Results</p>
            <p style="font-size: 0.9em; margin-top: 10px;" id="timestamp"></p>
        </div>

        <div class="content">
            <!-- Key Metrics -->
            <div class="metrics-grid">
                <div class="metric-card success">
                    <div class="metric-label">Total Steps</div>
                    <div class="metric-value" id="totalSteps">-</div>
                    <div class="metric-subtitle" id="expectedSteps">-</div>
                </div>

                <div class="metric-card info">
                    <div class="metric-label">Total API Calls</div>
                    <div class="metric-value" id="totalCalls">-</div>
                    <div class="metric-subtitle" id="avgCalls">-</div>
                </div>

                <div class="metric-card warning">
                    <div class="metric-label">Red Flags</div>
                    <div class="metric-value" id="redFlags">-</div>
                    <div class="metric-subtitle" id="flagRate">-</div>
                </div>

                <div class="metric-card danger">
                    <div class="metric-label">Runtime</div>
                    <div class="metric-value" id="runtime">-</div>
                    <div class="metric-subtitle" id="avgTime">-</div>
                </div>
            </div>

            <!-- Video Section -->
            <div class="section">
                <h2>üé¨ Solution Visualization</h2>
                <div class="video-container" id="videoContainer">
                    <p>Video will be displayed here</p>
                </div>
            </div>

            <!-- Token Usage -->
            <div class="section">
                <h2>üìä Token Usage Breakdown</h2>
                <div class="cost-breakdown">
                    <div class="cost-item">
                        <h3>Token Statistics</h3>
                        <div class="cost-detail">
                            <span>Total Input Tokens:</span>
                            <span id="inputTokens">-</span>
                        </div>
                        <div class="cost-detail">
                            <span>Total Output Tokens:</span>
                            <span id="outputTokens">-</span>
                        </div>
                        <div class="cost-detail">
                            <span>Grand Total:</span>
                            <span id="totalTokens">-</span>
                        </div>
                    </div>

                    <div class="cost-item">
                        <h3>Per-Call Averages</h3>
                        <div class="cost-detail">
                            <span>Avg Input Tokens:</span>
                            <span id="avgInput">-</span>
                        </div>
                        <div class="cost-detail">
                            <span>Avg Output Tokens:</span>
                            <span id="avgOutput">-</span>
                        </div>
                        <div class="cost-detail">
                            <span>Avg Total per Call:</span>
                            <span id="avgTotal">-</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cost Estimation -->
            <div class="section">
                <h2>üí∞ Compute Cost Estimation (T4 GPU on Colab)</h2>
                <div class="cost-breakdown">
                    <div class="cost-item">
                        <h3>Current Run</h3>
                        <div class="cost-detail">
                            <span>Runtime (hours):</span>
                            <span id="runtimeHours">-</span>
                        </div>
                        <div class="cost-detail">
                            <span>Compute Units:</span>
                            <span id="computeUnits">-</span>
                        </div>
                        <div class="cost-detail">
                            <span>Estimated Cost:</span>
                            <span id="estimatedCost">-</span>
                        </div>
                    </div>

                    <div class="cost-item">
                        <h3>Cost Breakdown</h3>
                        <div class="cost-detail">
                            <span>T4 GPU Rate:</span>
                            <span>~1.48 units/hour</span>
                        </div>
                        <div class="cost-detail">
                            <span>Colab Pro Rate:</span>
                            <span>$12.41 per ~100 units</span>
                        </div>
                        <div class="cost-detail">
                            <span>Per Unit Cost:</span>
                            <span>~$0.1241</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scaling Predictions -->
            <div class="section">
                <h2>üìà Scaling Predictions</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Disks</th>
                            <th>Steps</th>
                            <th>Est. API Calls</th>
                            <th>Est. Time</th>
                            <th>Compute Units</th>
                            <th>Est. Cost</th>
                        </tr>
                    </thead>
                    <tbody id="scalingTable">
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>

                <div class="alert warning">
                    <strong>‚ö†Ô∏è Note:</strong> Larger disk counts (15-20) require days or weeks of continuous GPU time and substantial compute costs!
                </div>
            </div>
        </div>
    </div>

    <script>
        function populateDashboard(data) {
            // Set timestamp
            document.getElementById('timestamp').textContent =
                'Run completed: ' + new Date().toLocaleString();

            // Metrics
            document.getElementById('totalSteps').textContent = data.total_steps;
            document.getElementById('expectedSteps').textContent =
                `Expected: ${Math.pow(2, data.num_disks) - 1} (2^${data.num_disks}-1)`;

            document.getElementById('totalCalls').textContent = data.total_api_calls;
            document.getElementById('avgCalls').textContent =
                `Avg: ${(data.total_api_calls / data.total_steps).toFixed(1)} per step`;

            document.getElementById('redFlags').textContent = data.total_red_flags;
            document.getElementById('flagRate').textContent =
                `Rate: ${(data.red_flag_rate * 100).toFixed(1)}% of calls`;

            document.getElementById('runtime').textContent = `${data.runtime_minutes.toFixed(1)}m`;
            document.getElementById('avgTime').textContent =
                `${data.avg_time_per_step.toFixed(1)}s per step`;

            // Tokens
            document.getElementById('inputTokens').textContent = data.total_input_tokens.toLocaleString();
            document.getElementById('outputTokens').textContent = data.total_output_tokens.toLocaleString();
            document.getElementById('totalTokens').textContent = data.total_tokens.toLocaleString();

            document.getElementById('avgInput').textContent =
                Math.round(data.total_input_tokens / data.total_api_calls).toLocaleString();
            document.getElementById('avgOutput').textContent =
                Math.round(data.total_output_tokens / data.total_api_calls).toLocaleString();
            document.getElementById('avgTotal').textContent =
                Math.round(data.avg_tokens_per_call).toLocaleString();

            // Cost
            const runtimeHours = data.runtime_minutes / 60;
            const computeUnits = runtimeHours * 1.48;
            const cost = computeUnits * 0.1241;

            document.getElementById('runtimeHours').textContent = runtimeHours.toFixed(2);
            document.getElementById('computeUnits').textContent = computeUnits.toFixed(2);
            document.getElementById('estimatedCost').textContent = `$${cost.toFixed(2)}`;

            // Scaling predictions
            const callsPerStep = data.total_api_calls / data.total_steps;
            const timePerCall = (data.runtime_minutes * 60) / data.total_api_calls;

            const scalingData = [
                {disks: 5, steps: 31},
                {disks: 6, steps: 63},
                {disks: 7, steps: 127},
                {disks: 8, steps: 255},
                {disks: 15, steps: 32767},
                {disks: 20, steps: 1048575}
            ];

            let tableHTML = '';
            scalingData.forEach(row => {
                const calls = Math.round(row.steps * callsPerStep);
                const timeMinutes = (calls * timePerCall) / 60;
                const timeHours = timeMinutes / 60;
                const units = timeHours * 1.48;
                const rowCost = units * 0.1241;

                const timeStr = timeHours > 24 ?
                    `${(timeHours / 24).toFixed(0)} days` :
                    timeHours > 1 ? `${timeHours.toFixed(0)} hrs` :
                    `${timeMinutes.toFixed(0)} min`;

                // Highlight the row if it matches current config
                const rowClass = (row.disks === data.num_disks) ? 'class="highlight-row"' : '';

                tableHTML += `
                    <tr ${rowClass}>
                        <td><strong>${row.disks}</strong></td>
                        <td>${row.steps.toLocaleString()}</td>
                        <td>${calls.toLocaleString()}</td>
                        <td>${timeStr}</td>
                        <td>${units.toFixed(1)}</td>
                        <td>$${rowCost.toFixed(2)}</td>
                    </tr>
                `;
            });

            document.getElementById('scalingTable').innerHTML = tableHTML;

            // Video
            if (data.video_path) {
                document.getElementById('videoContainer').innerHTML = `
                    <video width="800" height="480" controls autoplay loop>
                        <source src="${data.video_path}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <p style="margin-top:10px; color:#666; font-size:0.9em;">
                       Right-click video to save | <a href="${data.video_path}" download>Download MP4</a>
                    </p>
                `;
            } else {
                document.getElementById('videoContainer').innerHTML = "<p>No video generated</p>";
            }
        }

        // Inject Data from Python
        const dashboardData = {"total_steps": 31, "num_disks": 5, "total_api_calls": 154, "total_red_flags": 53, "red_flag_rate": 0.34415584415584416, "runtime_minutes": 44.98850942850113, "avg_time_per_step": 87.07276193557247, "total_input_tokens": 23432, "total_output_tokens": 6329, "total_tokens": 29761, "avg_tokens_per_call": 193.25324675324674, "video_path": "hanoi_5_solution.mp4"};

        // Init
        populateDashboard(dashboardData);
    </script>
</body>
</html>